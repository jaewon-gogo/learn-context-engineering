# ìŠ¤í¬ì¸ íŒ€ ê²½ê¸°ì¼ì • ìº˜ë¦°ë” ì›¹ì‚¬ì´íŠ¸ ìƒì„¸ ì„¤ê³„ì„œ

## 1. ì‹œìŠ¤í…œ ê°œìš”

### 1.1 ì‹œìŠ¤í…œì˜ ëª©ì 

ìŠ¤í¬ì¸ íŒ€ ê²½ê¸°ì¼ì • ìº˜ë¦°ë” ì›¹ì‚¬ì´íŠ¸ëŠ” 10ì‚´ ì•„ë™ì´ ì¢‹ì•„í•˜ëŠ” ìŠ¤í¬ì¸ íŒ€ì˜ ê²½ê¸°ì¼ì •ì„ ìë™ìœ¼ë¡œ ìˆ˜ì§‘í•˜ì—¬ ìº˜ë¦°ë” í˜•íƒœë¡œ ì‹œê°í™”í•˜ê³ , Google ìº˜ë¦°ë”ì— ìë™ìœ¼ë¡œ ë™ê¸°í™”í•˜ëŠ” ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì…ë‹ˆë‹¤.

### 1.2 ì•„í‚¤í…ì²˜ ê°œìš”

ë³¸ ì‹œìŠ¤í…œì€ **ëª¨ë†€ë¦¬ì‹ ì•„í‚¤í…ì²˜**ë¥¼ ì±„íƒí•˜ì—¬ êµ¬í˜„ë©ë‹ˆë‹¤.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Frontend (Next.js)              â”‚
â”‚  - React ì»´í¬ë„ŒíŠ¸                       â”‚
â”‚  - shadcn/ui + Tailwind CSS            â”‚
â”‚  - ìº˜ë¦°ë” UI                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ REST API
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Backend (Node.js/Express)        â”‚
â”‚  - RESTful API                           â”‚
â”‚  - Google OAuth 2.0 ì¸ì¦ ì²˜ë¦¬           â”‚
â”‚  - í¬ë¡¤ë§ ìŠ¤ì¼€ì¤„ëŸ¬                       â”‚
â”‚  - Google Calendar API í´ë¼ì´ì–¸íŠ¸        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Data Layer (SQLite)              â”‚
â”‚  - ì‚¬ìš©ì ì •ë³´                           â”‚
â”‚  - í¬ë¡¤ë§ ë°ì´í„° ìºì‹œ                     â”‚
â”‚  - OAuth í† í° (ì•”í˜¸í™”)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         External APIs                    â”‚
â”‚  - Google Calendar API (REST)           â”‚
â”‚  - Google OAuth 2.0 ì„œë²„                 â”‚
â”‚  - í¬ë¡¤ë§ ëŒ€ìƒ ì›¹ì‚¬ì´íŠ¸                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3 ê¸°ìˆ  ìŠ¤íƒ

#### Frontend
- **í”„ë ˆì„ì›Œí¬**: Next.js 14+ (App Router)
- **UI ë¼ì´ë¸ŒëŸ¬ë¦¬**: shadcn/ui + Tailwind CSS
- **ìº˜ë¦°ë” ë¼ì´ë¸ŒëŸ¬ë¦¬**: react-big-calendar ë˜ëŠ” fullcalendar-react
- **ìƒíƒœ ê´€ë¦¬**: React Hooks (useState, useEffect, useReducer)
- **ì•„ì´ì½˜**: lucide-react

#### Backend
- **ëŸ°íƒ€ì„**: Node.js 18+
- **í”„ë ˆì„ì›Œí¬**: Express.js
- **ì¸ì¦**: Google OAuth 2.0 (google-auth-library)
- **ìº˜ë¦°ë” API**: googleapis (Google Calendar API)
- **í¬ë¡¤ë§**: Puppeteer ë˜ëŠ” Cheerio
- **ë°ì´í„°ë² ì´ìŠ¤**: SQLite (sqlite3)

#### ì¸í”„ë¼
- **í”„ë¡ íŠ¸ì—”ë“œ í˜¸ìŠ¤íŒ…**: Vercel ë˜ëŠ” Netlify
- **ë°±ì—”ë“œ í˜¸ìŠ¤íŒ…**: Vercel Functions ë˜ëŠ” AWS Lambda
- **ë°ì´í„°ë² ì´ìŠ¤**: SQLite íŒŒì¼ (í´ë¼ìš°ë“œ ìŠ¤í† ë¦¬ì§€ ë˜ëŠ” ì„œë²„ë¦¬ìŠ¤ í™˜ê²½)

---

## 2. ì»´í¬ë„ŒíŠ¸ ì„¤ê³„

### 2.1 Frontend ì»´í¬ë„ŒíŠ¸

#### 2.1.1 ì¸ì¦ ì»´í¬ë„ŒíŠ¸

**GoogleLoginButton**
```typescript
// components/features/GoogleLoginButton.tsx
interface GoogleLoginButtonProps {
  onSuccess?: (user: User) => void;
  onError?: (error: Error) => void;
}

export function GoogleLoginButton({ onSuccess, onError }: GoogleLoginButtonProps) {
  // Google OAuth ë¡œê·¸ì¸ ì²˜ë¦¬
  // - /api/v1/auth/google ì—”ë“œí¬ì¸íŠ¸ í˜¸ì¶œ
  // - ë¦¬ë””ë ‰ì…˜ ì²˜ë¦¬
  // - ì„±ê³µ/ì‹¤íŒ¨ ì½œë°±
}
```

**ì†ì„±**:
- `onSuccess`: ë¡œê·¸ì¸ ì„±ê³µ ì‹œ ì½œë°±
- `onError`: ë¡œê·¸ì¸ ì‹¤íŒ¨ ì‹œ ì½œë°±

**ë©”ì„œë“œ**:
- `handleLogin()`: Google OAuth ë¡œê·¸ì¸ ì‹œì‘
- `handleCallback(code: string)`: OAuth ì½œë°± ì²˜ë¦¬

#### 2.1.2 ë°ì´í„° ì„ íƒ ì»´í¬ë„ŒíŠ¸

**SportSelector**
```typescript
// components/features/SportSelector.tsx
interface SportSelectorProps {
  selectedSportId?: number;
  onSelect: (sportId: number) => void;
  disabled?: boolean;
}

export function SportSelector({ selectedSportId, onSelect, disabled }: SportSelectorProps) {
  // ìŠ¤í¬ì¸  ì¢…ëª© ëª©ë¡ ì¡°íšŒ
  // - GET /api/v1/sports í˜¸ì¶œ
  // - ë“œë¡­ë‹¤ìš´ ë˜ëŠ” ë²„íŠ¼ ê·¸ë£¹ìœ¼ë¡œ í‘œì‹œ
  // - ì„ íƒ ì‹œ onSelect ì½œë°± í˜¸ì¶œ
}
```

**TeamSelector**
```typescript
// components/features/TeamSelector.tsx
interface TeamSelectorProps {
  sportId: number;
  selectedTeamId?: number;
  onSelect: (teamId: number) => void;
  disabled?: boolean;
}

export function TeamSelector({ sportId, selectedTeamId, onSelect, disabled }: TeamSelectorProps) {
  // íŒ€ ëª©ë¡ ì¡°íšŒ
  // - GET /api/v1/teams?sports_id={sportId} í˜¸ì¶œ
  // - ë“œë¡­ë‹¤ìš´ ë˜ëŠ” ê²€ìƒ‰ UI ì œê³µ
  // - ì„ íƒ ì‹œ onSelect ì½œë°± í˜¸ì¶œ
}
```

#### 2.1.3 ìº˜ë¦°ë” ì»´í¬ë„ŒíŠ¸

**ScheduleCalendar**
```typescript
// components/features/ScheduleCalendar.tsx
interface ScheduleCalendarProps {
  teamId: number;
  currentMonth: Date;
  onMonthChange: (month: Date) => void;
  onGameClick: (schedule: Schedule) => void;
}

export function ScheduleCalendar({
  teamId,
  currentMonth,
  onMonthChange,
  onGameClick,
}: ScheduleCalendarProps) {
  // ê²½ê¸°ì¼ì • ì¡°íšŒ
  // - GET /api/v1/schedules?team_id={teamId}&start_date={start}&end_date={end} í˜¸ì¶œ
  // - ì›”ë³„ ìº˜ë¦°ë” ê·¸ë¦¬ë“œ í‘œì‹œ
  // - ê²½ê¸°ì¼ì • ì•„ì´ì½˜ í‘œì‹œ
  // - í´ë¦­ ì‹œ onGameClick ì½œë°± í˜¸ì¶œ
}
```

**GameDetailModal**
```typescript
// components/features/GameDetailModal.tsx
interface GameDetailModalProps {
  schedule: Schedule;
  open: boolean;
  onClose: () => void;
  onAddToCalendar?: (schedule: Schedule) => void;
}

export function GameDetailModal({
  schedule,
  open,
  onClose,
  onAddToCalendar,
}: GameDetailModalProps) {
  // ê²½ê¸° ìƒì„¸ ì •ë³´ ëª¨ë‹¬ í‘œì‹œ
  // - ë‚ ì§œ, ì‹œê°„, ìƒëŒ€íŒ€, ì¥ì†Œ ì •ë³´
  // - Google ìº˜ë¦°ë”ì— ì¶”ê°€ ë²„íŠ¼
}
```

#### 2.1.4 ì„¤ì • ì»´í¬ë„ŒíŠ¸

**CalendarSyncSettings**
```typescript
// components/features/CalendarSyncSettings.tsx
interface CalendarSyncSettingsProps {
  userId: number;
  onSave?: () => void;
}

export function CalendarSyncSettings({ userId, onSave }: CalendarSyncSettingsProps) {
  // ìº˜ë¦°ë” ì—°ë™ ì„¤ì •
  // - GET /api/v1/calendar/list í˜¸ì¶œ
  // - ìº˜ë¦°ë” ì„ íƒ UI
  // - ìë™ ë™ê¸°í™” ì„¤ì •
  // - PUT /api/v1/calendar/settings í˜¸ì¶œ
}
```

### 2.2 Backend ì»´í¬ë„ŒíŠ¸

#### 2.2.1 ì¸ì¦ ëª¨ë“ˆ

**AuthService**
```typescript
// services/AuthService.ts
export class AuthService {
  // Google OAuth ì¸ì¦ ì²˜ë¦¬
  async initiateGoogleLogin(redirectUri: string): Promise<string>
  async handleGoogleCallback(code: string): Promise<User>
  async refreshToken(userId: number): Promise<TokenPair>
  async logout(userId: number): Promise<void>
  async verifyToken(token: string): Promise<User>
}
```

**ë©”ì„œë“œ ìƒì„¸**:
- `initiateGoogleLogin()`: Google OAuth ì¸ì¦ URL ìƒì„±
- `handleGoogleCallback()`: ì¸ì¦ ì½”ë“œë¥¼ í† í°ìœ¼ë¡œ êµí™˜í•˜ê³  ì‚¬ìš©ì ì •ë³´ ì €ì¥
- `refreshToken()`: ë§Œë£Œëœ í† í° ìë™ ê°±ì‹ 
- `logout()`: ì‚¬ìš©ì ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬
- `verifyToken()`: JWT í† í° ê²€ì¦

#### 2.2.2 í¬ë¡¤ë§ ëª¨ë“ˆ

**CrawlerService**
```typescript
// services/CrawlerService.ts
export class CrawlerService {
  // ê²½ê¸°ì¼ì • í¬ë¡¤ë§
  async crawlSchedule(teamId: number): Promise<Schedule[]>
  async parseSchedule(html: string, teamId: number): Promise<Schedule[]>
  async saveSchedules(schedules: Schedule[]): Promise<void>
  async getCrawlHistory(teamId: number): Promise<CrawlHistory[]>
}
```

**ë©”ì„œë“œ ìƒì„¸**:
- `crawlSchedule()`: ì›¹ì‚¬ì´íŠ¸ì—ì„œ ê²½ê¸°ì¼ì • í¬ë¡¤ë§
- `parseSchedule()`: HTML íŒŒì‹±í•˜ì—¬ ê²½ê¸°ì¼ì • ë°ì´í„° ì¶”ì¶œ
- `saveSchedules()`: ë°ì´í„°ë² ì´ìŠ¤ì— ê²½ê¸°ì¼ì • ì €ì¥
- `getCrawlHistory()`: í¬ë¡¤ë§ ì´ë ¥ ì¡°íšŒ

#### 2.2.3 ìº˜ë¦°ë” ì—°ë™ ëª¨ë“ˆ

**CalendarSyncService**
```typescript
// services/CalendarSyncService.ts
export class CalendarSyncService {
  // Google Calendar ì—°ë™
  async listCalendars(userId: number): Promise<Calendar[]>
  async syncSchedule(userId: number, scheduleIds: number[]): Promise<SyncResult>
  async createEvent(userId: number, schedule: Schedule): Promise<string>
  async updateEvent(userId: number, eventId: string, schedule: Schedule): Promise<void>
  async deleteEvent(userId: number, eventId: string): Promise<void>
  async getSyncStatus(userId: number): Promise<SyncStatus>
}
```

**ë©”ì„œë“œ ìƒì„¸**:
- `listCalendars()`: ì‚¬ìš©ìì˜ Google ìº˜ë¦°ë” ëª©ë¡ ì¡°íšŒ
- `syncSchedule()`: ê²½ê¸°ì¼ì •ì„ Google ìº˜ë¦°ë”ì— ë™ê¸°í™”
- `createEvent()`: Google Calendarì— ì´ë²¤íŠ¸ ìƒì„±
- `updateEvent()`: ê¸°ì¡´ ì´ë²¤íŠ¸ ì—…ë°ì´íŠ¸
- `deleteEvent()`: ì´ë²¤íŠ¸ ì‚­ì œ
- `getSyncStatus()`: ë™ê¸°í™” ìƒíƒœ ì¡°íšŒ

---

## 3. 4+1 View ëª¨ë¸

### 3.1 ë…¼ë¦¬ ë·° (Logical View)

ë…¼ë¦¬ ë·°ëŠ” ì‹œìŠ¤í…œì˜ ì£¼ìš” ì»´í¬ë„ŒíŠ¸ì™€ ê·¸ë“¤ ê°„ì˜ ê´€ê³„ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.

```mermaid
graph TB
    subgraph Frontend
        UI[UI Components]
        AuthUI[Authentication UI]
        CalendarUI[Calendar UI]
        SettingsUI[Settings UI]
    end
    
    subgraph Backend
        APIRouter[API Router]
        AuthService[Auth Service]
        CrawlerService[Crawler Service]
        CalendarService[Calendar Sync Service]
        ScheduleService[Schedule Service]
    end
    
    subgraph DataLayer
        UserDB[(User DB)]
        ScheduleDB[(Schedule DB)]
        Cache[(Cache)]
    end
    
    subgraph External
        GoogleOAuth[Google OAuth]
        GoogleCalendar[Google Calendar API]
        CrawlTarget[í¬ë¡¤ë§ ëŒ€ìƒ ì‚¬ì´íŠ¸]
    end
    
    UI --> AuthUI
    UI --> CalendarUI
    UI --> SettingsUI
    
    AuthUI --> APIRouter
    CalendarUI --> APIRouter
    SettingsUI --> APIRouter
    
    APIRouter --> AuthService
    APIRouter --> ScheduleService
    APIRouter --> CrawlerService
    APIRouter --> CalendarService
    
    AuthService --> UserDB
    AuthService --> GoogleOAuth
    
    ScheduleService --> ScheduleDB
    ScheduleService --> Cache
    
    CrawlerService --> CrawlTarget
    CrawlerService --> ScheduleDB
    
    CalendarService --> UserDB
    CalendarService --> GoogleCalendar
    CalendarService --> ScheduleDB
```

### 3.2 ê°œë°œ ë·° (Development View)

ê°œë°œ ë·°ëŠ” í”„ë¡œì íŠ¸ì˜ ë””ë ‰í† ë¦¬ êµ¬ì¡°ì™€ ê°œë°œ í™˜ê²½ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.

#### í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ êµ¬ì¡°

```
sports-schedule-calendar/
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”‚   â”œâ”€â”€ (auth)/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ layout.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ dashboard/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ settings/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ calendar/
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ notifications/
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â””â”€â”€ layout.tsx
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ ui/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ button.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ input.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ card.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ select.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ dialog.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”‚   â”œâ”€â”€ layout/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Header.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Sidebar.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Footer.tsx
â”‚   â”‚   â”‚   â””â”€â”€ features/
â”‚   â”‚   â”‚       â”œâ”€â”€ GoogleLoginButton.tsx
â”‚   â”‚   â”‚       â”œâ”€â”€ SportSelector.tsx
â”‚   â”‚   â”‚       â”œâ”€â”€ TeamSelector.tsx
â”‚   â”‚   â”‚       â”œâ”€â”€ ScheduleCalendar.tsx
â”‚   â”‚   â”‚       â”œâ”€â”€ GameDetailModal.tsx
â”‚   â”‚   â”‚       â”œâ”€â”€ CalendarSyncSettings.tsx
â”‚   â”‚   â”‚       â””â”€â”€ NotificationSettings.tsx
â”‚   â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”‚   â”œâ”€â”€ utils.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ api.ts
â”‚   â”‚   â”‚   â””â”€â”€ auth.ts
â”‚   â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”‚   â”œâ”€â”€ useAuth.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ useSchedule.ts
â”‚   â”‚   â”‚   â””â”€â”€ useCalendar.ts
â”‚   â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â””â”€â”€ styles/
â”‚   â”‚       â””â”€â”€ globals.css
â”‚   â”œâ”€â”€ public/
â”‚   â”‚   â””â”€â”€ images/
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ tsconfig.json
â”‚   â”œâ”€â”€ tailwind.config.js
â”‚   â””â”€â”€ next.config.js
â”‚
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.routes.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ schedule.routes.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ calendar.routes.ts
â”‚   â”‚   â”‚   â””â”€â”€ team.routes.ts
â”‚   â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.controller.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ schedule.controller.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ calendar.controller.ts
â”‚   â”‚   â”‚   â””â”€â”€ team.controller.ts
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â”œâ”€â”€ AuthService.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ CrawlerService.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ CalendarSyncService.ts
â”‚   â”‚   â”‚   â””â”€â”€ ScheduleService.ts
â”‚   â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”‚   â”œâ”€â”€ User.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ Schedule.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ Team.ts
â”‚   â”‚   â”‚   â””â”€â”€ CalendarSettings.ts
â”‚   â”‚   â”œâ”€â”€ database/
â”‚   â”‚   â”‚   â”œâ”€â”€ db.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ migrations/
â”‚   â”‚   â”‚   â””â”€â”€ seeds/
â”‚   â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.middleware.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ error.middleware.ts
â”‚   â”‚   â”‚   â””â”€â”€ validation.middleware.ts
â”‚   â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”‚   â”œâ”€â”€ encryption.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ logger.ts
â”‚   â”‚   â”‚   â””â”€â”€ validator.ts
â”‚   â”‚   â””â”€â”€ config/
â”‚   â”‚       â”œâ”€â”€ database.config.ts
â”‚   â”‚       â”œâ”€â”€ oauth.config.ts
â”‚   â”‚       â””â”€â”€ app.config.ts
â”‚   â”œâ”€â”€ tests/
â”‚   â”‚   â”œâ”€â”€ unit/
â”‚   â”‚   â”œâ”€â”€ integration/
â”‚   â”‚   â””â”€â”€ e2e/
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ tsconfig.json
â”‚   â””â”€â”€ .env.example
â”‚
â”œâ”€â”€ shared/
â”‚   â””â”€â”€ types/
â”‚       â””â”€â”€ index.ts
â”‚
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ adr.md
â”‚   â”œâ”€â”€ database.md
â”‚   â”œâ”€â”€ api-spec.md
â”‚   â””â”€â”€ ui-design.md
â”‚
â”œâ”€â”€ .gitignore
â”œâ”€â”€ README.md
â””â”€â”€ package.json (workspace root)
```

#### ì£¼ìš” ë¼ì´ë¸ŒëŸ¬ë¦¬

**Frontend**:
```json
{
  "dependencies": {
    "next": "^14.0.0",
    "react": "^18.0.0",
    "react-dom": "^18.0.0",
    "@radix-ui/react-dialog": "^1.0.0",
    "@radix-ui/react-select": "^1.0.0",
    "tailwindcss": "^3.3.0",
    "lucide-react": "^0.294.0",
    "react-big-calendar": "^1.8.0"
  }
}
```

**Backend**:
```json
{
  "dependencies": {
    "express": "^4.18.0",
    "googleapis": "^126.0.0",
    "google-auth-library": "^9.0.0",
    "sqlite3": "^5.1.0",
    "puppeteer": "^21.0.0",
    "cheerio": "^1.0.0",
    "jsonwebtoken": "^9.0.0",
    "bcrypt": "^5.1.0",
    "cors": "^2.8.5",
    "dotenv": "^16.3.0"
  }
}
```

#### ê°œë°œ ë„êµ¬

- **ì–¸ì–´**: TypeScript 5.0+
- **íŒ¨í‚¤ì§€ ê´€ë¦¬**: npm ë˜ëŠ” yarn
- **ì½”ë“œ í¬ë§·íŒ…**: Prettier
- **ë¦°íŒ…**: ESLint
- **í…ŒìŠ¤íŠ¸**: Jest, React Testing Library
- **ë²„ì „ ê´€ë¦¬**: Git

### 3.3 í”„ë¡œì„¸ìŠ¤ ë·° (Process View)

í”„ë¡œì„¸ìŠ¤ ë·°ëŠ” ì‹œìŠ¤í…œì˜ ë™ì  ë™ì‘ì„ ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨ìœ¼ë¡œ ë³´ì—¬ì¤ë‹ˆë‹¤.

#### ì‚¬ìš©ì ë¡œê·¸ì¸ í”„ë¡œì„¸ìŠ¤

```mermaid
sequenceDiagram
    participant User
    participant Frontend
    participant Backend
    participant GoogleOAuth
    participant Database

    User->>Frontend: Google ë¡œê·¸ì¸ ë²„íŠ¼ í´ë¦­
    Frontend->>Backend: GET /api/v1/auth/google
    Backend->>GoogleOAuth: OAuth ì¸ì¦ URL ìƒì„±
    GoogleOAuth-->>Backend: ì¸ì¦ URL
    Backend-->>Frontend: 302 Redirect
    Frontend->>GoogleOAuth: ì‚¬ìš©ì ì¸ì¦
    GoogleOAuth-->>Frontend: ì¸ì¦ ì½”ë“œ (callback)
    Frontend->>Backend: GET /api/v1/auth/google/callback?code=xxx
    Backend->>GoogleOAuth: í† í° êµí™˜
    GoogleOAuth-->>Backend: Access Token, Refresh Token
    Backend->>GoogleOAuth: ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ
    GoogleOAuth-->>Backend: ì‚¬ìš©ì ì •ë³´
    Backend->>Database: ì‚¬ìš©ì ì •ë³´ ì €ì¥/ì—…ë°ì´íŠ¸
    Database-->>Backend: ì €ì¥ ì™„ë£Œ
    Backend->>Backend: JWT í† í° ìƒì„±
    Backend-->>Frontend: ì‚¬ìš©ì ì •ë³´ + JWT í† í°
    Frontend->>Frontend: í† í° ì €ì¥ (localStorage)
    Frontend-->>User: ëŒ€ì‹œë³´ë“œë¡œ ë¦¬ë””ë ‰ì…˜
```

#### ê²½ê¸°ì¼ì • ì¡°íšŒ í”„ë¡œì„¸ìŠ¤

```mermaid
sequenceDiagram
    participant User
    participant Frontend
    participant Backend
    participant Database
    participant Crawler

    User->>Frontend: íŒ€ ì„ íƒ
    Frontend->>Frontend: ì„ íƒëœ íŒ€ ID ì €ì¥
    Frontend->>Backend: GET /api/v1/schedules?team_id=1
    Backend->>Backend: JWT í† í° ê²€ì¦
    Backend->>Database: ê²½ê¸°ì¼ì • ì¡°íšŒ
    alt ìºì‹œëœ ë°ì´í„° ì¡´ì¬
        Database-->>Backend: ê²½ê¸°ì¼ì • ë°ì´í„°
    else ìºì‹œ ë¯¸ì¡´ì¬
        Backend->>Crawler: í¬ë¡¤ë§ ì‹¤í–‰
        Crawler-->>Backend: ê²½ê¸°ì¼ì • ë°ì´í„°
        Backend->>Database: ë°ì´í„° ì €ì¥
        Database-->>Backend: ì €ì¥ ì™„ë£Œ
    end
    Backend-->>Frontend: ê²½ê¸°ì¼ì • ëª©ë¡
    Frontend->>Frontend: ìº˜ë¦°ë”ì— í‘œì‹œ
    Frontend-->>User: ê²½ê¸°ì¼ì • í‘œì‹œ
```

#### Google ìº˜ë¦°ë” ë™ê¸°í™” í”„ë¡œì„¸ìŠ¤

```mermaid
sequenceDiagram
    participant User
    participant Frontend
    participant Backend
    participant Database
    participant GoogleCalendar

    User->>Frontend: ìº˜ë¦°ë” ë™ê¸°í™” ë²„íŠ¼ í´ë¦­
    Frontend->>Backend: POST /api/v1/calendar/sync
    Backend->>Backend: JWT í† í° ê²€ì¦
    Backend->>Database: ì‚¬ìš©ì OAuth í† í° ì¡°íšŒ
    Database-->>Backend: ì•”í˜¸í™”ëœ í† í°
    Backend->>Backend: í† í° ë³µí˜¸í™”
    Backend->>Backend: í† í° ë§Œë£Œ í™•ì¸
    alt í† í° ë§Œë£Œ
        Backend->>GoogleCalendar: Refresh Tokenìœ¼ë¡œ ê°±ì‹ 
        GoogleCalendar-->>Backend: ìƒˆ Access Token
        Backend->>Database: ìƒˆ í† í° ì €ì¥
    end
    Backend->>Database: ë™ê¸°í™”í•  ê²½ê¸°ì¼ì • ì¡°íšŒ
    Database-->>Backend: ê²½ê¸°ì¼ì • ëª©ë¡
    loop ê° ê²½ê¸°ì¼ì •
        Backend->>GoogleCalendar: ì´ë²¤íŠ¸ ìƒì„±
        GoogleCalendar-->>Backend: ì´ë²¤íŠ¸ ID
        Backend->>Database: ë™ê¸°í™” ì´ë ¥ ì €ì¥
    end
    Backend-->>Frontend: ë™ê¸°í™” ê²°ê³¼
    Frontend-->>User: ë™ê¸°í™” ì™„ë£Œ ë©”ì‹œì§€
```

### 3.4 ë¬¼ë¦¬ ë·° (Physical View)

ë¬¼ë¦¬ ë·°ëŠ” ì‹œìŠ¤í…œì˜ ë°°í¬ êµ¬ì¡°ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.

```mermaid
graph TB
    subgraph "Client"
        Browser[ì›¹ ë¸Œë¼ìš°ì €]
    end
    
    subgraph "Vercel / Netlify"
        FrontendApp[Next.js Frontend]
        StaticFiles[ì •ì  íŒŒì¼]
    end
    
    subgraph "Vercel Functions / AWS Lambda"
        APIServer[Express API Server]
        AuthFunction[ì¸ì¦ í•¨ìˆ˜]
        CrawlerFunction[í¬ë¡¤ë§ í•¨ìˆ˜]
        CalendarFunction[ìº˜ë¦°ë” ë™ê¸°í™” í•¨ìˆ˜]
    end
    
    subgraph "Cloud Storage"
        SQLiteDB[(SQLite DB)]
        CacheStore[(ìºì‹œ ì €ì¥ì†Œ)]
    end
    
    subgraph "External Services"
        GoogleOAuth[Google OAuth 2.0]
        GoogleCalendar[Google Calendar API]
        CrawlTarget[í¬ë¡¤ë§ ëŒ€ìƒ ì‚¬ì´íŠ¸]
    end
    
    Browser --> FrontendApp
    Browser --> StaticFiles
    
    FrontendApp --> APIServer
    FrontendApp --> AuthFunction
    FrontendApp --> CrawlerFunction
    FrontendApp --> CalendarFunction
    
    APIServer --> SQLiteDB
    APIServer --> CacheStore
    
    AuthFunction --> GoogleOAuth
    CalendarFunction --> GoogleCalendar
    CrawlerFunction --> CrawlTarget
    
    AuthFunction --> SQLiteDB
    CalendarFunction --> SQLiteDB
    CrawlerFunction --> SQLiteDB
```

### 3.5 ìœ ìŠ¤ì¼€ì´ìŠ¤ ë·° (Use Case View)

ì£¼ìš” ìœ ìŠ¤ì¼€ì´ìŠ¤ë¥¼ ë‹¤ì´ì–´ê·¸ë¨ìœ¼ë¡œ ë³´ì—¬ì¤ë‹ˆë‹¤.

```mermaid
graph LR
    User[ì‚¬ìš©ì]
    
    UC1[ë¡œê·¸ì¸]
    UC2[íŒ€ ì„ íƒ]
    UC3[ê²½ê¸°ì¼ì • ì¡°íšŒ]
    UC4[ê²½ê¸° ìƒì„¸ ì •ë³´ í™•ì¸]
    UC5[ìº˜ë¦°ë” ë™ê¸°í™”]
    UC6[ì•Œë¦¼ ì„¤ì •]
    
    User --> UC1
    User --> UC2
    User --> UC3
    User --> UC4
    User --> UC5
    User --> UC6
    
    UC1 --> UC2
    UC2 --> UC3
    UC3 --> UC4
    UC3 --> UC5
    UC5 --> UC6
```

#### ìœ ìŠ¤ì¼€ì´ìŠ¤ ìƒì„¸

**UC1: ë¡œê·¸ì¸**
- **ì•¡í„°**: ì‚¬ìš©ì
- **ì „ì œì¡°ê±´**: ì—†ìŒ
- **ê¸°ë³¸ íë¦„**:
  1. ì‚¬ìš©ìê°€ Google ë¡œê·¸ì¸ ë²„íŠ¼ í´ë¦­
  2. Google OAuth ì¸ì¦ í˜ì´ì§€ë¡œ ë¦¬ë””ë ‰ì…˜
  3. ì‚¬ìš©ìê°€ Google ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸ ë° ê¶Œí•œ ìŠ¹ì¸
  4. ì‹œìŠ¤í…œì´ ì‚¬ìš©ì ì •ë³´ë¥¼ ì €ì¥í•˜ê³  JWT í† í° ë°œê¸‰
  5. ëŒ€ì‹œë³´ë“œë¡œ ë¦¬ë””ë ‰ì…˜

**UC2: íŒ€ ì„ íƒ**
- **ì•¡í„°**: ì¸ì¦ëœ ì‚¬ìš©ì
- **ì „ì œì¡°ê±´**: ë¡œê·¸ì¸ ì™„ë£Œ
- **ê¸°ë³¸ íë¦„**:
  1. ì‚¬ìš©ìê°€ ìŠ¤í¬ì¸  ì¢…ëª© ì„ íƒ
  2. ì‹œìŠ¤í…œì´ í•´ë‹¹ ì¢…ëª©ì˜ íŒ€ ëª©ë¡ í‘œì‹œ
  3. ì‚¬ìš©ìê°€ íŒ€ ì„ íƒ
  4. ì‹œìŠ¤í…œì´ ì„ íƒëœ íŒ€ì˜ ê²½ê¸°ì¼ì • ì¡°íšŒ

**UC3: ê²½ê¸°ì¼ì • ì¡°íšŒ**
- **ì•¡í„°**: ì¸ì¦ëœ ì‚¬ìš©ì
- **ì „ì œì¡°ê±´**: íŒ€ ì„ íƒ ì™„ë£Œ
- **ê¸°ë³¸ íë¦„**:
  1. ì‹œìŠ¤í…œì´ ì„ íƒëœ íŒ€ì˜ ê²½ê¸°ì¼ì • ì¡°íšŒ
  2. ìº˜ë¦°ë” í˜•íƒœë¡œ ê²½ê¸°ì¼ì • í‘œì‹œ
  3. ê²½ê¸°ê°€ ìˆëŠ” ë‚ ì§œì— ì•„ì´ì½˜ í‘œì‹œ

**UC4: ê²½ê¸° ìƒì„¸ ì •ë³´ í™•ì¸**
- **ì•¡í„°**: ì¸ì¦ëœ ì‚¬ìš©ì
- **ì „ì œì¡°ê±´**: ê²½ê¸°ì¼ì • í‘œì‹œ ì¤‘
- **ê¸°ë³¸ íë¦„**:
  1. ì‚¬ìš©ìê°€ ê²½ê¸°ì¼ì • ì•„ì´ì½˜ í´ë¦­
  2. ì‹œìŠ¤í…œì´ ê²½ê¸° ìƒì„¸ ì •ë³´ ëª¨ë‹¬ í‘œì‹œ
  3. ë‚ ì§œ, ì‹œê°„, ìƒëŒ€íŒ€, ì¥ì†Œ ì •ë³´ í‘œì‹œ

**UC5: ìº˜ë¦°ë” ë™ê¸°í™”**
- **ì•¡í„°**: ì¸ì¦ëœ ì‚¬ìš©ì
- **ì „ì œì¡°ê±´**: ë¡œê·¸ì¸ ì™„ë£Œ, Google ìº˜ë¦°ë” ê¶Œí•œ ìŠ¹ì¸
- **ê¸°ë³¸ íë¦„**:
  1. ì‚¬ìš©ìê°€ ìº˜ë¦°ë” ë™ê¸°í™” ë²„íŠ¼ í´ë¦­
  2. ì‹œìŠ¤í…œì´ Google ìº˜ë¦°ë” ëª©ë¡ ì¡°íšŒ
  3. ì‚¬ìš©ìê°€ ìº˜ë¦°ë” ì„ íƒ
  4. ì‹œìŠ¤í…œì´ ê²½ê¸°ì¼ì •ì„ Google ìº˜ë¦°ë”ì— ì´ë²¤íŠ¸ë¡œ ì¶”ê°€
  5. ë™ê¸°í™” ì™„ë£Œ ë©”ì‹œì§€ í‘œì‹œ

**UC6: ì•Œë¦¼ ì„¤ì •**
- **ì•¡í„°**: ì¸ì¦ëœ ì‚¬ìš©ì
- **ì „ì œì¡°ê±´**: ë¡œê·¸ì¸ ì™„ë£Œ
- **ê¸°ë³¸ íë¦„**:
  1. ì‚¬ìš©ìê°€ ì„¤ì • ë©”ë‰´ ì„ íƒ
  2. ì‹œìŠ¤í…œì´ ì•Œë¦¼ ì„¤ì • í™”ë©´ í‘œì‹œ
  3. ì‚¬ìš©ìê°€ ì´ë©”ì¼/í‘¸ì‹œ ì•Œë¦¼ ì˜µì…˜ ì„ íƒ
  4. ì‚¬ìš©ìê°€ ì•Œë¦¼ ì‹œì  ì„ íƒ
  5. ì‹œìŠ¤í…œì´ ì„¤ì • ì €ì¥

---

## 4. ë°ì´í„° ëª¨ë¸

### 4.1 ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ

ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„ì„œë¥¼ ì°¸ê³ í•˜ì—¬ ìƒì„¸ ìŠ¤í‚¤ë§ˆë¥¼ ì •ì˜í•©ë‹ˆë‹¤. (ìì„¸í•œ ë‚´ìš©ì€ `sports-schedule-calendar-database.md` ì°¸ì¡°)

### 4.2 ì£¼ìš” ì—”í„°í‹° ê´€ê³„

```mermaid
erDiagram
    Users ||--o{ UserTeams : "has"
    Users ||--|| CalendarSettings : "has"
    Users ||--o{ CalendarSyncHistory : "has"
    Sports ||--o{ Teams : "has"
    Teams ||--o{ Schedules : "has"
    Teams ||--o{ CrawlHistory : "has"
    Teams ||--o{ UserTeams : "selected_by"
    Schedules ||--o{ CalendarSyncHistory : "synced_to"
```

### 4.3 ë°ì´í„° íƒ€ì… ì •ì˜

```typescript
// shared/types/index.ts

export interface User {
  user_id: number;
  google_user_id: string;
  email: string;
  name: string;
  profile_image_url?: string;
  is_active: boolean;
  created_at: string;
  last_login_at: string;
}

export interface Sport {
  sports_id: number;
  sports_name: string;
  display_order: number;
  is_active: boolean;
}

export interface Team {
  team_id: number;
  sports_id: number;
  team_name: string;
  team_official_name?: string;
  crawl_url: string;
  is_active: boolean;
}

export interface Schedule {
  schedule_id: number;
  team_id: number;
  team_name: string;
  game_date: string; // YYYY-MM-DD
  game_time?: string; // HH:MM
  opponent_team: string;
  venue_type: 'HOME' | 'AWAY';
  venue_name?: string;
  game_status: 'SCHEDULED' | 'IN_PROGRESS' | 'FINISHED' | 'CANCELLED';
  game_result?: string;
  score?: string;
  crawled_at: string;
  updated_at?: string;
}

export interface CalendarSettings {
  settings_id: number;
  user_id: number;
  google_calendar_id: string;
  calendar_name: string;
  auto_sync: boolean;
  sync_interval: 'HOURLY' | 'DAILY' | 'WEEKLY';
  email_notification: boolean;
  push_notification: boolean;
  notification_timing: string;
  calendar_color?: string;
  is_shared: boolean;
  created_at: string;
  updated_at?: string;
}

export interface CalendarSyncHistory {
  sync_id: number;
  user_id: number;
  schedule_id: number;
  google_event_id?: string;
  sync_status: 'SUCCESS' | 'FAILED' | 'PENDING';
  synced_at: string;
  error_message?: string;
  error_code?: string;
}
```

---

## 5. API ì„¤ê³„

API ëª…ì„¸ì„œë¥¼ ì°¸ê³ í•˜ì—¬ ìƒì„¸ ì„¤ê³„ë¥¼ ì •ì˜í•©ë‹ˆë‹¤. (ìì„¸í•œ ë‚´ìš©ì€ `sports-schedule-calendar-api-spec.md` ì°¸ì¡°)

### 5.1 ì£¼ìš” API ì—”ë“œí¬ì¸íŠ¸

| ë©”ì„œë“œ | ê²½ë¡œ | ì„¤ëª… | ì¸ì¦ |
|--------|------|------|------|
| GET | `/api/v1/auth/google` | Google OAuth ë¡œê·¸ì¸ ì‹œì‘ | âŒ |
| GET | `/api/v1/auth/google/callback` | Google OAuth ì½œë°± | âŒ |
| POST | `/api/v1/auth/logout` | ë¡œê·¸ì•„ì›ƒ | âœ… |
| GET | `/api/v1/sports` | ìŠ¤í¬ì¸  ì¢…ëª© ëª©ë¡ | âœ… |
| GET | `/api/v1/teams` | íŒ€ ëª©ë¡ | âœ… |
| GET | `/api/v1/schedules` | ê²½ê¸°ì¼ì • ì¡°íšŒ | âœ… |
| POST | `/api/v1/schedules/crawl` | í¬ë¡¤ë§ ì‹¤í–‰ | âœ… |
| GET | `/api/v1/calendar/list` | Google ìº˜ë¦°ë” ëª©ë¡ | âœ… |
| POST | `/api/v1/calendar/sync` | ìº˜ë¦°ë” ë™ê¸°í™” | âœ… |
| PUT | `/api/v1/calendar/settings` | ìº˜ë¦°ë” ì„¤ì • ìˆ˜ì • | âœ… |

### 5.2 API êµ¬í˜„ ì˜ˆì‹œ

#### ì¸ì¦ ì—”ë“œí¬ì¸íŠ¸ êµ¬í˜„

```typescript
// backend/src/routes/auth.routes.ts
import { Router } from 'express';
import { AuthController } from '../controllers/auth.controller';
import { authMiddleware } from '../middleware/auth.middleware';

const router = Router();
const authController = new AuthController();

router.get('/google', authController.initiateGoogleLogin);
router.get('/google/callback', authController.handleGoogleCallback);
router.post('/logout', authMiddleware, authController.logout);
router.get('/me', authMiddleware, authController.getCurrentUser);

export default router;
```

```typescript
// backend/src/controllers/auth.controller.ts
import { Request, Response } from 'express';
import { AuthService } from '../services/AuthService';

export class AuthController {
  private authService: AuthService;

  constructor() {
    this.authService = new AuthService();
  }

  async initiateGoogleLogin(req: Request, res: Response) {
    try {
      const redirectUri = `${req.protocol}://${req.get('host')}/api/v1/auth/google/callback`;
      const authUrl = await this.authService.initiateGoogleLogin(redirectUri);
      res.redirect(authUrl);
    } catch (error) {
      res.status(500).json({
        error: 'OAUTH_ERROR',
        message: 'OAuth ì„¤ì • ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤',
        details: {},
      });
    }
  }

  async handleGoogleCallback(req: Request, res: Response) {
    try {
      const { code } = req.query;
      if (!code || typeof code !== 'string') {
        return res.status(400).json({
          error: 'INVALID_CODE',
          message: 'ìœ íš¨í•˜ì§€ ì•Šì€ ì¸ì¦ ì½”ë“œì…ë‹ˆë‹¤',
          details: {},
        });
      }

      const { user, token } = await this.authService.handleGoogleCallback(code);
      res.json({
        success: true,
        user,
        token,
      });
    } catch (error) {
      res.status(500).json({
        error: 'AUTH_ERROR',
        message: 'ì¸ì¦ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤',
        details: {},
      });
    }
  }

  async logout(req: Request, res: Response) {
    try {
      const userId = (req as any).user.user_id;
      await this.authService.logout(userId);
      res.json({
        success: true,
        message: 'ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤',
      });
    } catch (error) {
      res.status(500).json({
        error: 'LOGOUT_ERROR',
        message: 'ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤',
        details: {},
      });
    }
  }

  async getCurrentUser(req: Request, res: Response) {
    try {
      const user = (req as any).user;
      res.json(user);
    } catch (error) {
      res.status(500).json({
        error: 'USER_ERROR',
        message: 'ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤',
        details: {},
      });
    }
  }
}
```

---

## 6. ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤ ì„¤ê³„

UI ì»¨ì…‰ ë° í”„ë¡œí† íƒ€ì… ë¬¸ì„œë¥¼ ì°¸ê³ í•˜ì—¬ ìƒì„¸ ì„¤ê³„ë¥¼ ì •ì˜í•©ë‹ˆë‹¤. (ìì„¸í•œ ë‚´ìš©ì€ `sports-schedule-calendar-ui-concept-prototype.md` ì°¸ì¡°)

### 6.1 ì£¼ìš” í™”ë©´ êµ¬ì„±

1. **ë¡œê·¸ì¸ í™”ë©´** (`/login`)
   - Google ë¡œê·¸ì¸ ë²„íŠ¼
   - ê°„ë‹¨í•œ ì„¤ëª… í…ìŠ¤íŠ¸

2. **ëŒ€ì‹œë³´ë“œ** (`/dashboard`)
   - í—¤ë” (ë¡œê³ , ì‚¬ìš©ì ì •ë³´, ì„¤ì •)
   - íŒ€ ì„ íƒ ì„¹ì…˜
   - ìº˜ë¦°ë” ë·°
   - ìº˜ë¦°ë” ë™ê¸°í™” ë²„íŠ¼

3. **ì„¤ì • í™”ë©´** (`/settings`)
   - ìº˜ë¦°ë” ì—°ë™ ì„¤ì •
   - ì•Œë¦¼ ì„¤ì •

### 6.2 UI ì»´í¬ë„ŒíŠ¸ êµ¬í˜„ ì˜ˆì‹œ

```tsx
// frontend/src/components/features/ScheduleCalendar.tsx
'use client';

import { useState, useEffect } from 'react';
import { Card } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { GameDetailModal } from './GameDetailModal';
import { fetchSchedules } from '@/lib/api';
import type { Schedule } from '@/types';

interface ScheduleCalendarProps {
  teamId: number;
  currentMonth: Date;
  onMonthChange: (month: Date) => void;
}

export function ScheduleCalendar({
  teamId,
  currentMonth,
  onMonthChange,
}: ScheduleCalendarProps) {
  const [schedules, setSchedules] = useState<Schedule[]>([]);
  const [selectedGame, setSelectedGame] = useState<Schedule | null>(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const loadSchedules = async () => {
      setLoading(true);
      try {
        const startDate = new Date(
          currentMonth.getFullYear(),
          currentMonth.getMonth(),
          1
        ).toISOString().split('T')[0];
        const endDate = new Date(
          currentMonth.getFullYear(),
          currentMonth.getMonth() + 1,
          0
        ).toISOString().split('T')[0];

        const data = await fetchSchedules(teamId, startDate, endDate);
        setSchedules(data.schedules);
      } catch (error) {
        console.error('ê²½ê¸°ì¼ì • ì¡°íšŒ ì‹¤íŒ¨:', error);
      } finally {
        setLoading(false);
      }
    };

    if (teamId) {
      loadSchedules();
    }
  }, [teamId, currentMonth]);

  // ìº˜ë¦°ë” ê·¸ë¦¬ë“œ ìƒì„± ë¡œì§
  const daysInMonth = new Date(
    currentMonth.getFullYear(),
    currentMonth.getMonth() + 1,
    0
  ).getDate();
  const firstDay = new Date(
    currentMonth.getFullYear(),
    currentMonth.getMonth(),
    1
  ).getDay();

  const days = [];
  for (let i = 0; i < firstDay; i++) {
    days.push(null);
  }
  for (let i = 1; i <= daysInMonth; i++) {
    days.push(i);
  }

  const schedulesByDate = schedules.reduce((acc, schedule) => {
    const date = schedule.game_date;
    if (!acc[date]) {
      acc[date] = [];
    }
    acc[date].push(schedule);
    return acc;
  }, {} as Record<string, Schedule[]>);

  if (loading) {
    return <Card className="p-4">ë¡œë”© ì¤‘...</Card>;
  }

  return (
    <Card className="p-4">
      {/* ì›” ë„¤ë¹„ê²Œì´ì…˜ */}
      <div className="flex items-center justify-between mb-4">
        <Button
          variant="outline"
          onClick={() => {
            const prevMonth = new Date(currentMonth);
            prevMonth.setMonth(prevMonth.getMonth() - 1);
            onMonthChange(prevMonth);
          }}
        >
          â—€ ì´ì „
        </Button>
        <h2 className="text-xl font-bold">
          {currentMonth.getFullYear()}ë…„ {currentMonth.getMonth() + 1}ì›”
        </h2>
        <Button
          variant="outline"
          onClick={() => {
            const nextMonth = new Date(currentMonth);
            nextMonth.setMonth(nextMonth.getMonth() + 1);
            onMonthChange(nextMonth);
          }}
        >
          ë‹¤ìŒ â–¶
        </Button>
      </div>

      {/* ìº˜ë¦°ë” ê·¸ë¦¬ë“œ */}
      <div className="grid grid-cols-7 gap-2">
        {['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '].map((day) => (
          <div key={day} className="text-center font-semibold text-sm p-2">
            {day}
          </div>
        ))}

        {days.map((day, index) => {
          const dateStr = day
            ? `${currentMonth.getFullYear()}-${String(currentMonth.getMonth() + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`
            : null;
          const daySchedules = dateStr ? schedulesByDate[dateStr] || [] : [];

          return (
            <div
              key={index}
              className={`min-h-20 p-2 border rounded-md ${
                day ? 'bg-white' : 'bg-gray-50'
              }`}
            >
              {day && (
                <>
                  <div className="text-sm font-medium mb-1">{day}</div>
                  {daySchedules.map((schedule) => (
                    <button
                      key={schedule.schedule_id}
                      onClick={() => setSelectedGame(schedule)}
                      className="w-full text-left text-xs p-1 bg-blue-100 hover:bg-blue-200 rounded mb-1"
                    >
                      ğŸŸï¸ {schedule.opponent_team}
                    </button>
                  ))}
                </>
              )}
            </div>
          );
        })}
      </div>

      {/* ê²½ê¸° ìƒì„¸ ëª¨ë‹¬ */}
      {selectedGame && (
        <GameDetailModal
          schedule={selectedGame}
          open={!!selectedGame}
          onClose={() => setSelectedGame(null)}
        />
      )}
    </Card>
  );
}
```

---

## 7. ë³´ì•ˆ ì„¤ê³„

### 7.1 ì¸ì¦ ë° ê¶Œí•œ ë¶€ì—¬

#### Google OAuth 2.0 ì¸ì¦

**í† í° ê´€ë¦¬**:
- Access Token: Google API í˜¸ì¶œìš© (1ì‹œê°„ ë§Œë£Œ)
- Refresh Token: Access Token ê°±ì‹ ìš© (ì¥ê¸° ìœ íš¨)
- JWT Token: ì• í”Œë¦¬ì¼€ì´ì…˜ ì„¸ì…˜ ê´€ë¦¬ìš©

**í† í° ì €ì¥**:
```typescript
// backend/src/services/AuthService.ts
import { encrypt, decrypt } from '../utils/encryption';

export class AuthService {
  async saveTokens(userId: number, tokens: TokenPair) {
    // AES-256 ì•”í˜¸í™”
    const encryptedAccessToken = encrypt(tokens.access_token);
    const encryptedRefreshToken = encrypt(tokens.refresh_token);

    await db.query(
      'UPDATE users SET oauth_token_encrypted = ?, refresh_token_encrypted = ?, token_expires_at = ? WHERE user_id = ?',
      [encryptedAccessToken, encryptedRefreshToken, tokens.expires_at, userId]
    );
  }

  async getTokens(userId: number): Promise<TokenPair> {
    const user = await db.query('SELECT * FROM users WHERE user_id = ?', [userId]);
    
    return {
      access_token: decrypt(user.oauth_token_encrypted),
      refresh_token: decrypt(user.refresh_token_encrypted),
      expires_at: user.token_expires_at,
    };
  }
}
```

#### JWT í† í° ê²€ì¦

```typescript
// backend/src/middleware/auth.middleware.ts
import { Request, Response, NextFunction } from 'express';
import jwt from 'jsonwebtoken';

export function authMiddleware(req: Request, res: Response, next: NextFunction) {
  const token = req.headers.authorization?.replace('Bearer ', '');

  if (!token) {
    return res.status(401).json({
      error: 'UNAUTHORIZED',
      message: 'ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤',
      details: { code: 'AUTH_REQUIRED' },
    });
  }

  try {
    const decoded = jwt.verify(token, process.env.JWT_SECRET!);
    (req as any).user = decoded;
    next();
  } catch (error) {
    return res.status(401).json({
      error: 'UNAUTHORIZED',
      message: 'ìœ íš¨í•˜ì§€ ì•Šì€ í† í°ì…ë‹ˆë‹¤',
      details: {},
    });
  }
}
```

### 7.2 ë°ì´í„° ë³´í˜¸

#### ì•”í˜¸í™”

**OAuth í† í° ì•”í˜¸í™”**:
```typescript
// backend/src/utils/encryption.ts
import crypto from 'crypto';

const ALGORITHM = 'aes-256-gcm';
const KEY = Buffer.from(process.env.ENCRYPTION_KEY!, 'hex');
const IV_LENGTH = 16;
const AUTH_TAG_LENGTH = 16;

export function encrypt(text: string): string {
  const iv = crypto.randomBytes(IV_LENGTH);
  const cipher = crypto.createCipheriv(ALGORITHM, KEY, iv);
  
  let encrypted = cipher.update(text, 'utf8', 'hex');
  encrypted += cipher.final('hex');
  
  const authTag = cipher.getAuthTag();
  
  return `${iv.toString('hex')}:${authTag.toString('hex')}:${encrypted}`;
}

export function decrypt(encryptedText: string): string {
  const [ivHex, authTagHex, encrypted] = encryptedText.split(':');
  
  const iv = Buffer.from(ivHex, 'hex');
  const authTag = Buffer.from(authTagHex, 'hex');
  
  const decipher = crypto.createDecipheriv(ALGORITHM, KEY, iv);
  decipher.setAuthTag(authTag);
  
  let decrypted = decipher.update(encrypted, 'hex', 'utf8');
  decrypted += decipher.final('utf8');
  
  return decrypted;
}
```

#### ì‚¬ìš©ìë³„ ë°ì´í„° ê²©ë¦¬

```typescript
// backend/src/services/ScheduleService.ts
export class ScheduleService {
  async getSchedules(userId: number, teamId: number, startDate: string, endDate: string) {
    // ì‚¬ìš©ìê°€ ì„ íƒí•œ íŒ€ì¸ì§€ í™•ì¸
    const userTeam = await db.query(
      'SELECT * FROM user_teams WHERE user_id = ? AND team_id = ?',
      [userId, teamId]
    );

    if (!userTeam) {
      throw new Error('ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤');
    }

    // ê²½ê¸°ì¼ì • ì¡°íšŒ
    return await db.query(
      'SELECT * FROM schedules WHERE team_id = ? AND game_date >= ? AND game_date <= ?',
      [teamId, startDate, endDate]
    );
  }
}
```

### 7.3 ì…ë ¥ ê²€ì¦

```typescript
// backend/src/middleware/validation.middleware.ts
import { Request, Response, NextFunction } from 'express';
import { z } from 'zod';

export function validateRequest(schema: z.ZodSchema) {
  return (req: Request, res: Response, next: NextFunction) => {
    try {
      schema.parse(req.body);
      next();
    } catch (error) {
      if (error instanceof z.ZodError) {
        return res.status(400).json({
          error: 'VALIDATION_ERROR',
          message: 'ì…ë ¥ê°’ì´ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤',
          details: error.errors,
        });
      }
      next(error);
    }
  };
}

// ì‚¬ìš© ì˜ˆì‹œ
const syncSchema = z.object({
  calendar_id: z.string().min(1),
  team_ids: z.array(z.number()).min(1),
  start_date: z.string().regex(/^\d{4}-\d{2}-\d{2}$/),
  end_date: z.string().regex(/^\d{4}-\d{2}-\d{2}$/),
});

router.post('/calendar/sync', validateRequest(syncSchema), calendarController.sync);
```

---

## 8. ì—ëŸ¬ ì²˜ë¦¬ ì„¤ê³„

### 8.1 ì—ëŸ¬ ì²˜ë¦¬ ì „ëµ

#### ì—ëŸ¬ ë¶„ë¥˜

1. **í´ë¼ì´ì–¸íŠ¸ ì˜¤ë¥˜ (4xx)**
   - ì˜ëª»ëœ ìš”ì²­
   - ì¸ì¦ ì‹¤íŒ¨
   - ê¶Œí•œ ì—†ìŒ
   - ë¦¬ì†ŒìŠ¤ ì—†ìŒ

2. **ì„œë²„ ì˜¤ë¥˜ (5xx)**
   - ë‚´ë¶€ ì„œë²„ ì˜¤ë¥˜
   - ë°ì´í„°ë² ì´ìŠ¤ ì˜¤ë¥˜
   - ì™¸ë¶€ API ì˜¤ë¥˜

3. **ì™¸ë¶€ ì„œë¹„ìŠ¤ ì˜¤ë¥˜**
   - Google OAuth ì˜¤ë¥˜
   - Google Calendar API ì˜¤ë¥˜
   - í¬ë¡¤ë§ ëŒ€ìƒ ì‚¬ì´íŠ¸ ì˜¤ë¥˜

#### ì—ëŸ¬ ì²˜ë¦¬ ë¯¸ë“¤ì›¨ì–´

```typescript
// backend/src/middleware/error.middleware.ts
import { Request, Response, NextFunction } from 'express';

export function errorHandler(
  err: Error,
  req: Request,
  res: Response,
  next: NextFunction
) {
  console.error('Error:', err);

  // ì—ëŸ¬ íƒ€ì…ì— ë”°ë¥¸ ì²˜ë¦¬
  if (err.name === 'ValidationError') {
    return res.status(400).json({
      error: 'VALIDATION_ERROR',
      message: err.message,
      details: {},
    });
  }

  if (err.name === 'UnauthorizedError') {
    return res.status(401).json({
      error: 'UNAUTHORIZED',
      message: 'ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤',
      details: {},
    });
  }

  if (err.message.includes('Google API')) {
    return res.status(502).json({
      error: 'EXTERNAL_API_ERROR',
      message: 'Google API í˜¸ì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤',
      details: { service: 'Google Calendar API' },
    });
  }

  // ê¸°ë³¸ ì—ëŸ¬
  res.status(500).json({
    error: 'INTERNAL_SERVER_ERROR',
    message: 'ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤',
    details: process.env.NODE_ENV === 'development' ? { stack: err.stack } : {},
  });
}
```

### 8.2 ì¬ì‹œë„ ë¡œì§

#### Google Calendar API ì¬ì‹œë„

```typescript
// backend/src/services/CalendarSyncService.ts
import { google } from 'googleapis';

export class CalendarSyncService {
  private async callWithRetry<T>(
    fn: () => Promise<T>,
    maxRetries = 3,
    delay = 1000
  ): Promise<T> {
    let lastError: Error;

    for (let i = 0; i < maxRetries; i++) {
      try {
        return await fn();
      } catch (error: any) {
        lastError = error;

        // Rate Limit ì—ëŸ¬ì¸ ê²½ìš°
        if (error.code === 429) {
          const retryAfter = parseInt(error.response.headers['retry-after'] || '60');
          await new Promise(resolve => setTimeout(resolve, retryAfter * 1000));
          continue;
        }

        // ì¬ì‹œë„ ê°€ëŠ¥í•œ ì—ëŸ¬ì¸ ê²½ìš°
        if (i < maxRetries - 1 && this.isRetryableError(error)) {
          await new Promise(resolve => setTimeout(resolve, delay * Math.pow(2, i)));
          continue;
        }

        throw error;
      }
    }

    throw lastError!;
  }

  private isRetryableError(error: any): boolean {
    // ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜, íƒ€ì„ì•„ì›ƒ, ì¼ì‹œì  ì„œë²„ ì˜¤ë¥˜
    return (
      error.code === 'ECONNRESET' ||
      error.code === 'ETIMEDOUT' ||
      error.code === 503 ||
      error.code === 502
    );
  }

  async createEvent(userId: number, schedule: Schedule): Promise<string> {
    const tokens = await this.authService.getTokens(userId);
    const auth = new google.auth.OAuth2();
    auth.setCredentials(tokens);

    const calendar = google.calendar({ version: 'v3', auth });

    return await this.callWithRetry(async () => {
      const response = await calendar.events.insert({
        calendarId: 'primary',
        requestBody: {
          summary: `${schedule.team_name} vs ${schedule.opponent_team}`,
          description: `ê²½ê¸°ì¼ì •: ${schedule.venue_name || 'ì¥ì†Œ ë¯¸ì •'}`,
          start: {
            dateTime: `${schedule.game_date}T${schedule.game_time || '18:00'}:00`,
            timeZone: 'Asia/Seoul',
          },
          end: {
            dateTime: `${schedule.game_date}T${schedule.game_time || '20:00'}:00`,
            timeZone: 'Asia/Seoul',
          },
          location: schedule.venue_name,
        },
      });

      return response.data.id!;
    });
  }
}
```

### 8.3 ë¡œê¹…

```typescript
// backend/src/utils/logger.ts
import winston from 'winston';

export const logger = winston.createLogger({
  level: process.env.LOG_LEVEL || 'info',
  format: winston.format.combine(
    winston.format.timestamp(),
    winston.format.errors({ stack: true }),
    winston.format.json()
  ),
  transports: [
    new winston.transports.Console({
      format: winston.format.combine(
        winston.format.colorize(),
        winston.format.simple()
      ),
    }),
    new winston.transports.File({ filename: 'error.log', level: 'error' }),
    new winston.transports.File({ filename: 'combined.log' }),
  ],
});

// ì‚¬ìš© ì˜ˆì‹œ
logger.info('ê²½ê¸°ì¼ì • í¬ë¡¤ë§ ì‹œì‘', { teamId: 1 });
logger.error('í¬ë¡¤ë§ ì‹¤íŒ¨', { error: error.message, teamId: 1 });
```

---

## 9. í…ŒìŠ¤íŠ¸ ì „ëµ

### 9.1 ë‹¨ìœ„ í…ŒìŠ¤íŠ¸

```typescript
// backend/tests/unit/services/AuthService.test.ts
import { AuthService } from '../../../src/services/AuthService';
import { describe, it, expect, beforeEach } from '@jest/globals';

describe('AuthService', () => {
  let authService: AuthService;

  beforeEach(() => {
    authService = new AuthService();
  });

  it('should generate OAuth URL', async () => {
    const url = await authService.initiateGoogleLogin('http://localhost:3000/callback');
    expect(url).toContain('accounts.google.com');
    expect(url).toContain('client_id');
  });

  it('should handle OAuth callback', async () => {
    // ëª¨ì˜ í…ŒìŠ¤íŠ¸
  });
});
```

### 9.2 í†µí•© í…ŒìŠ¤íŠ¸

```typescript
// backend/tests/integration/api/auth.test.ts
import request from 'supertest';
import app from '../../../src/app';

describe('Auth API', () => {
  it('should redirect to Google OAuth', async () => {
    const response = await request(app)
      .get('/api/v1/auth/google')
      .expect(302);
    
    expect(response.headers.location).toContain('accounts.google.com');
  });
});
```

### 9.3 E2E í…ŒìŠ¤íŠ¸

```typescript
// frontend/tests/e2e/login.test.ts
import { test, expect } from '@playwright/test';

test('ë¡œê·¸ì¸ í”Œë¡œìš°', async ({ page }) => {
  await page.goto('http://localhost:3000/login');
  
  await page.click('text=Googleë¡œ ë¡œê·¸ì¸');
  
  // Google OAuth í˜ì´ì§€ë¡œ ë¦¬ë””ë ‰ì…˜ í™•ì¸
  await expect(page).toHaveURL(/accounts.google.com/);
});
```

---

## 10. ë°°í¬ ê³ ë ¤ì‚¬í•­

### 10.1 í™˜ê²½ ë³€ìˆ˜

```bash
# .env.example
# Google OAuth
GOOGLE_CLIENT_ID=your_client_id
GOOGLE_CLIENT_SECRET=your_client_secret
GOOGLE_REDIRECT_URI=http://localhost:3000/api/v1/auth/google/callback

# JWT
JWT_SECRET=your_jwt_secret

# Encryption
ENCRYPTION_KEY=your_32_byte_hex_key

# Database
DATABASE_PATH=./data/sports_schedule.db

# Server
PORT=3000
NODE_ENV=development
```

### 10.2 ë°°í¬ ì ˆì°¨

1. **í”„ë¡ íŠ¸ì—”ë“œ ë°°í¬** (Vercel)
   ```bash
   vercel --prod
   ```

2. **ë°±ì—”ë“œ ë°°í¬** (Vercel Functions)
   ```bash
   vercel --prod
   ```

3. **ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜**
   ```bash
   npm run migrate
   ```

### 10.3 ëª¨ë‹ˆí„°ë§

- **ì—ëŸ¬ ë¡œê¹…**: Winston ë¡œê±° ì‚¬ìš©
- **ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§**: Vercel Analytics
- **ì•Œë¦¼**: ì—ëŸ¬ ë°œìƒ ì‹œ ì´ë©”ì¼ ì•Œë¦¼ (ì„ íƒ)

---

**ì‘ì„±ì¼**: 2025-11-05  
**ì‘ì„±ì**: ì†Œí”„íŠ¸ì›¨ì–´ ì—”ì§€ë‹ˆì–´  
**ìƒíƒœ**: ì„¤ê³„ ì™„ë£Œ

**ì°¸ê³ **: ì´ ìƒì„¸ ì„¤ê³„ì„œëŠ” ADR, ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„, API ëª…ì„¸, UI ì»¨ì…‰ ë¬¸ì„œë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤. ì‹¤ì œ êµ¬í˜„ ì‹œ í”„ë¡œì íŠ¸ ìš”êµ¬ì‚¬í•­ì— ë§ê²Œ ì¡°ì •ì´ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

